"""
–ú–æ–¥—É–ª—å –∏–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ (i18n) –¥–ª—è –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –°–∫–∞–∑–æ–∫.
–°–æ–¥–µ—Ä–∂–∏—Ç –ø–µ—Ä–µ–≤–æ–¥—ã UI –¥–ª—è –≤—Å–µ—Ö –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —è–∑—ã–∫–æ–≤.
"""

from typing import Dict, Any

# === –ü–ï–†–ï–í–û–î–´ UI ===
TRANSLATIONS: Dict[str, Dict[str, Any]] = {
    'ru': {
        # –ú–µ—Ç–∞
        'page_title': "–°–∫–∞–∑–∫–∏ –¥–ª—è –¥–µ—Ç–µ–π",
        'page_icon': "üßö",
        
        # –•–µ–¥–µ—Ä
        'app_title': "üßö –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –°–∫–∞–∑–æ–∫",
        'app_subtitle': "–£–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç <span style='animation: magic-glow 3s infinite alternate; color: #FFD700;'>–≤–æ–ª—à–µ–±–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏</span> –¥–ª—è –í–∞—Å –∏ –í–∞—à–∏—Ö –¥–µ—Ç–µ–π ‚ú®",
        
        # –°–∞–π–¥–±–∞—Ä
        'settings_title': "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏",
        'theme_label': "üé® –¢–µ–º–∞",
        'theme_day': "‚òÄÔ∏è –î–µ–Ω—å",
        'theme_night': "üåô –ù–æ—á—å",
        'voice_label': "üéôÔ∏è –ì–æ–ª–æ—Å –æ–∑–≤—É—á–∫–∏",
        'voice_male': "–î–º–∏—Ç—Ä–∏–π (–ú—É–∂—Å–∫–æ–π)",
        'voice_female': "–°–≤–µ—Ç–ª–∞–Ω–∞ (–ñ–µ–Ω—Å–∫–∏–π)",
        'preview_btn': "üîä",
        'library_title': "üìö –ú–æ–∏ —Å–∫–∞–∑–∫–∏",
        'library_empty': "–ü–æ–∫–∞ –ø—É—Å—Ç–æ. –°–æ–∑–¥–∞–π—Ç–µ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å–∫–∞–∑–∫—É!",
        'duration_label': "‚è±Ô∏è –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∫–∞–∑–∫–∏",
        'duration_short': "üêá –ö–æ—Ä–æ—Ç–∫–∞—è (~1 –º–∏–Ω)",
        'duration_medium': "‚≠ê –°—Ä–µ–¥–Ω—è—è (~3 –º–∏–Ω)",
        'duration_long': "üê¢ –î–ª–∏–Ω–Ω–∞—è (~5 –º–∏–Ω)",
        'duration_long_hint': "üíé –î–ª–∏–Ω–Ω—ã–µ —Å–∫–∞–∑–∫–∏ –ª—É—á—à–µ –¥–ª—è –¥–µ—Ç–µ–π –æ—Ç 7 –ª–µ—Ç.",
        'donate_title': "### –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–µ–∫—Ç ‚òï",
        'donate_text': "–ï—Å–ª–∏ –≤–∞–º –Ω—Ä–∞–≤—è—Ç—Å—è –Ω–∞—à–∏ —Å–∫–∞–∑–∫–∏, –≤—ã –º–æ–∂–µ—Ç–µ —É–≥–æ—Å—Ç–∏—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∫–æ—Ñ–µ!",
        'donate_btn': "‚òï Buy Me a Coffee",
        'version_label': "–í–µ—Ä—Å–∏—è",
        
        # –§–æ—Ä–º–∞
        'name_label': "–ò–º—è —Ä–µ–±–µ–Ω–∫–∞",
        'name_placeholder': "–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–Ω—è",
        'gender_label': "–ü–æ–ª –≥–µ—Ä–æ—è",
        'gender_auto': "–ê–≤—Ç–æ",
        'gender_boy': "–ú–∞–ª—å—á–∏–∫",
        'gender_girl': "–î–µ–≤–æ—á–∫–∞",
        'gender_help': "–ü–æ–º–æ–≥–∞–µ—Ç –ò–ò –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–∫–ª–æ–Ω—è—Ç—å –∏–º—è",
        'age_label': "–í–æ–∑—Ä–∞—Å—Ç",
        'genre_label': "üé≠ –ñ–∞–Ω—Ä –∏—Å—Ç–æ—Ä–∏–∏",
        'hobbies_label': "üé® –û —á–µ–º —Å–∫–∞–∑–∫–∞ / –í–∞–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏",
        'hobbies_placeholder': "–ù–∞–ø—Ä–∏–º–µ—Ä: –ª—é–±–∏—Ç –¥–∏–Ω–æ–∑–∞–≤—Ä–æ–≤, –±–æ–∏—Ç—Å—è —Ç–µ–º–Ω–æ—Ç—ã, —Ö–æ—á–µ—Ç –Ω–∞–π—Ç–∏ –∫–ª–∞–¥...",
        'hobbies_help': "–õ—é–±—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è –∫ —Å—é–∂–µ—Ç—É –∏–ª–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä—É –≥–µ—Ä–æ—è",
        'submit_btn': "‚ú® –ü—Ä–∏–¥—É–º–∞—Ç—å —Å–∫–∞–∑–∫—É",
        
        # –°–æ–æ–±—â–µ–Ω–∏—è
        'api_key_warning': "‚ö†Ô∏è API –∫–ª—é—á Google –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ secrets.toml",
        'api_key_input': "üîë –í–≤–µ–¥–∏—Ç–µ –≤–∞—à Google API Key",
        'api_key_error': "üîë –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á –≤ –º–µ–Ω—é —Å–ª–µ–≤–∞, —á—Ç–æ–±—ã –º–∞–≥–∏—è —Å—Ä–∞–±–æ—Ç–∞–ª–∞!",
        'name_warning': "‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–ø–∏—à–∏—Ç–µ –∏–º—è —Ä–µ–±–µ–Ω–∫–∞.",
        'name_invalid': "‚ö†Ô∏è –ò–º—è –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, –ø—Ä–æ–±–µ–ª—ã –∏ –¥–µ—Ñ–∏—Å—ã.",
        'generating': "ü™Ñ –°–æ—á–∏–Ω—è–µ–º –≤–æ–ª—à–µ–±–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é",
        'processing_audio': "üéß –°–æ–∑–¥–∞–µ–º –∞—É–¥–∏–æ...",
        'save_btn': "üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É",
        'saved_success': "‚úÖ –°–∫–∞–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!",
        'download_txt': "üìÑ –°–∫–∞—á–∞—Ç—å —Ç–µ–∫—Å—Ç",
        'logout_btn': "üö™ –í—ã–π—Ç–∏",
        
        # –ñ–∞–Ω—Ä—ã
        'genres': {
            'fairytale': "–°–∫–∞–∑–∫–∞",
            'adventure': "–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ",
            'scifi': "–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞",
            'detective': "–î–µ—Ç–µ–∫—Ç–∏–≤",
            'fantasy': "–§—ç–Ω—Ç–µ–∑–∏",
            'superhero': "–°—É–ø–µ—Ä–≥–µ—Ä–æ–∏–∫–∞",
            'educational': "–ü–æ—É—á–∏—Ç–µ–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è",
            'lullaby': "–ö–æ–ª—ã–±–µ–ª—å–Ω–∞—è",
            'mystery': "–ú–∏—Å—Ç–∏–∫–∞",
            'cyberpunk': "–ö–∏–±–µ—Ä–ø–∞–Ω–∫",
            'philosophical': "–§–∏–ª–æ—Å–æ—Ñ—Å–∫–∞—è –ø—Ä–∏—Ç—á–∞",
            'romance': "–†–æ–º–∞–Ω—Ç–∏–∫–∞"
        },
        
        # –í–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –≥—Ä—É–ø–ø—ã
        'age_ranges': {
            "0-12 –º–µ—Å": "0-12 –º–µ—Å",
            "1-3 –≥–æ–¥–∞": "1-3 –≥–æ–¥–∞",
            "4-7 –ª–µ—Ç": "4-7 –ª–µ—Ç",
            "8-12 –ª–µ—Ç": "8-12 –ª–µ—Ç",
            "13-17 –ª–µ—Ç": "13-17 –ª–µ—Ç",
            "18+": "18+"
        }
    },
    
    'en': {
        # Meta
        'page_title': "Fairy Tales for Kids",
        'page_icon': "üßö",
        
        # Header
        'app_title': "üßö Fairy Tale Generator",
        'app_subtitle': "A smart assistant that creates <span style='animation: magic-glow 3s infinite alternate; color: #FFD700;'>magical stories</span> for you and your children ‚ú®",
        
        # Sidebar
        'settings_title': "‚öôÔ∏è Settings",
        'theme_label': "üé® Theme",
        'theme_day': "‚òÄÔ∏è Day",
        'theme_night': "üåô Night",
        'voice_label': "üéôÔ∏è Narrator Voice",
        'voice_male': "Guy (Male)",
        'voice_female': "Jenny (Female)",
        'preview_btn': "üîä",
        'library_title': "üìö My Stories",
        'library_empty': "Nothing yet. Create and save a story!",
        'duration_label': "‚è±Ô∏è Story Duration",
        'duration_short': "üêá Short (~1 min)",
        'duration_medium': "‚≠ê Medium (~3 min)",
        'duration_long': "üê¢ Long (~5 min)",
        'duration_long_hint': "üíé Long stories are better for kids 7+.",
        'donate_title': "### Support the Project ‚òï",
        'donate_text': "If you enjoy our fairy tales, you can buy the developer a coffee!",
        'donate_btn': "‚òï Buy Me a Coffee",
        'version_label': "Version",
        
        # Form
        'name_label': "Child's Name",
        'name_placeholder': "e.g., Emma",
        'gender_label': "Hero's Gender",
        'gender_auto': "Auto",
        'gender_boy': "Boy",
        'gender_girl': "Girl",
        'gender_help': "Helps AI use correct pronouns",
        'age_label': "Age",
        'genre_label': "üé≠ Story Genre",
        'hobbies_label': "üé® Story Theme / Important Details",
        'hobbies_placeholder': "e.g., loves dinosaurs, afraid of the dark, wants to find treasure...",
        'hobbies_help': "Any wishes for the plot or character traits",
        'submit_btn': "‚ú® Create a Story",
        
        # Messages
        'api_key_warning': "‚ö†Ô∏è Google API key not found in secrets.toml",
        'api_key_input': "üîë Enter your Google API Key",
        'api_key_error': "üîë Please enter an API key in the left menu for the magic to work!",
        'name_warning': "‚ö†Ô∏è Please enter the child's name.",
        'name_invalid': "‚ö†Ô∏è Name can only contain letters, spaces, and hyphens.",
        'generating': "ü™Ñ Composing a magical story",
        'processing_audio': "üéß Creating audio...",
        'save_btn': "üíæ Save to Library",
        'saved_success': "‚úÖ Story saved!",
        'download_txt': "üìÑ Download Text",
        'logout_btn': "üö™ Logout",
        
        # Genres
        'genres': {
            'fairytale': "Fairy Tale",
            'adventure': "Adventure",
            'scifi': "Sci-Fi",
            'detective': "Detective",
            'fantasy': "Fantasy",
            'superhero': "Superhero",
            'educational': "Educational",
            'lullaby': "Lullaby",
            'mystery': "Mystery",
            'cyberpunk': "Cyberpunk",
            'philosophical': "Philosophical Parable",
            'romance': "Romance"
        },
        
        # Age ranges
        'age_ranges': {
            "0-12 months": "0-12 months",
            "1-3 years": "1-3 years",
            "4-7 years": "4-7 years",
            "8-12 years": "8-12 years",
            "13-17 years": "13-17 years",
            "18+": "18+"
        }
    }
}


def t(key: str, lang: str = 'ru', **kwargs) -> str:
    """
    –ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥ –ø–æ –∫–ª—é—á—É.
    –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∫–ª—é—á–∏ —á–µ—Ä–µ–∑ —Ç–æ—á–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'genres.fairytale').
    
    Args:
        key: –ö–ª—é—á –ø–µ—Ä–µ–≤–æ–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'page_title' –∏–ª–∏ 'genres.fairytale')
        lang: –ö–æ–¥ —è–∑—ã–∫–∞ ('ru', 'en')
        **kwargs: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–æ–∫–∏
    
    Returns:
        str: –ü–µ—Ä–µ–≤–µ–¥—ë–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –∏–ª–∏ –∫–ª—é—á, –µ—Å–ª–∏ –ø–µ—Ä–µ–≤–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω
    """
    # Fallback –Ω–∞ —Ä—É—Å—Å–∫–∏–π, –µ—Å–ª–∏ —è–∑—ã–∫ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
    if lang not in TRANSLATIONS:
        lang = 'ru'
    
    # –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–µ–≤–æ–¥ (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –∫–ª—é—á–µ–π —á–µ—Ä–µ–∑ —Ç–æ—á–∫—É)
    translation = TRANSLATIONS.get(lang, {})
    for part in key.split('.'):
        if isinstance(translation, dict):
            translation = translation.get(part)
        else:
            translation = None
            break
    
    # –ï—Å–ª–∏ –ø–µ—Ä–µ–≤–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É–µ–º fallback –Ω–∞ —Ä—É—Å—Å–∫–∏–π
    if translation is None:
        translation = TRANSLATIONS.get('ru', {})
        for part in key.split('.'):
            if isinstance(translation, dict):
                translation = translation.get(part)
            else:
                translation = None
                break
    
    # –ï—Å–ª–∏ –≤—Å—ë –µ—â—ë –Ω–µ –Ω–∞–π–¥–µ–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–ª—é—á
    if translation is None or not isinstance(translation, str):
        return key
    
    # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
    if kwargs:
        try:
            return translation.format(**kwargs)
        except (KeyError, ValueError):
            return translation
    
    return translation


def get_translations(lang: str = 'ru') -> Dict[str, Any]:
    """
    –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è —è–∑—ã–∫–∞.
    
    Args:
        lang: –ö–æ–¥ —è–∑—ã–∫–∞ ('ru', 'en')
    
    Returns:
        Dict: –°–ª–æ–≤–∞—Ä—å —Å–æ –≤—Å–µ–º–∏ –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏
    """
    if lang not in TRANSLATIONS:
        lang = 'ru'
    return TRANSLATIONS.get(lang, TRANSLATIONS['ru'])


def get_genre_list(lang: str = 'ru') -> list:
    """
    –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–º —è–∑—ã–∫–µ.
    
    Args:
        lang: –ö–æ–¥ —è–∑—ã–∫–∞ ('ru', 'en')
    
    Returns:
        list: –°–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤
    """
    if lang not in TRANSLATIONS:
        lang = 'ru'
    genres = TRANSLATIONS.get(lang, {}).get('genres', {})
    if isinstance(genres, dict):
        return sorted(genres.values())
    return []


def get_age_ranges(lang: str = 'ru') -> Dict[str, float]:
    """
    –ü–æ–ª—É—á–∏—Ç—å –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –≥—Ä—É–ø–ø—ã –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–º —è–∑—ã–∫–µ.
    
    Args:
        lang: –ö–æ–¥ —è–∑—ã–∫–∞ ('ru', 'en')
    
    Returns:
        Dict: –°–ª–æ–≤–∞—Ä—å {–Ω–∞–∑–≤–∞–Ω–∏–µ: –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π_–∏–Ω–¥–µ–∫—Å}
    """
    # –í–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã —Ç–µ –∂–µ –¥–ª—è –≤—Å–µ—Ö —è–∑—ã–∫–æ–≤
    age_values = {
        "0-12 –º–µ—Å": 0.5,
        "1-3 –≥–æ–¥–∞": 2,
        "4-7 –ª–µ—Ç": 5,
        "8-12 –ª–µ—Ç": 10,
        "13-17 –ª–µ—Ç": 15,
        "18+": 25
    }
    
    # –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–µ–≤–µ–¥—ë–Ω–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é –∏–∑ TRANSLATIONS
    if lang not in TRANSLATIONS:
        lang = 'ru'
    translated_ranges = TRANSLATIONS.get(lang, {}).get('age_ranges', {})
    
    if isinstance(translated_ranges, dict) and translated_ranges:
        # –ú–∞–ø–ø–∏–Ω–≥ –∫–ª—é—á–µ–π –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º
        keys = list(translated_ranges.keys())
        key_mapping = {
            "0-12 –º–µ—Å": keys[0],
            "1-3 –≥–æ–¥–∞": keys[1],
            "4-7 –ª–µ—Ç": keys[2],
            "8-12 –ª–µ—Ç": keys[3],
            "13-17 –ª–µ—Ç": keys[4],
            "18+": keys[5]
        }
        return {key_mapping[k]: v for k, v in age_values.items()}
    
    return age_values
    
    return age_values
