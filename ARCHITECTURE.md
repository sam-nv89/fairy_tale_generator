# Архитектура проекта - Генератор Аудио-Сказок

## Обзор
Это одностраничное веб-приложение (SPA), созданное на Streamlit, представляющее собой MVP генератора сказок с использованием ИИ. Приложение принимает параметры от пользователя (имя ребенка, возраст, хобби), генерирует историю через Google Gemini и озвучивает её с помощью Microsoft Edge TTS.

## Ключевые архитектурные решения

### 1. Фронтенд и Управление состоянием
- **Фреймворк**: Streamlit (Python-UI).
- **Обоснование**: Возможность быстрого прототипирования, встроенная обработка состояния виджетов.
- **Компоненты**:
    - **Боковая панель**: Информация о проекте (скрыта/минималистична в финальной версии).
    - **Хедер**: Выбор голоса (Дмитрий/Светлана) и кнопка проверки.
    - **Основная область**: Форма ввода, отображение текста сказки и кастомный аудиоплеер.
- **Управление состоянием**: Используется `st.session_state` для сохранения:
    - `current_story`: Заголовок, текст и аудио-файл текущей сказки.
    - Это предотвращает потерю данных при перезагрузке страницы (rerun) после нажатия кнопок.

### 2. ИИ и Генерация текста
- **Провайдер**: Google Gemini API (модель: `gemini-1.5-flash` или `gemini-2.0-flash-exp`).
- **Аутентификация**: Через `st.secrets` для публичного использования без показа ключа, либо ручной ввод (как запасной вариант).
- **Промпт-инжиниринг**:
    - Строгая структура: "Заголовок" + перенос строки + "Текст".
    - Ролевая модель: "Добрый сказочник", "Короткие абзацы", "Простой язык".
    - Язык: Строго русский.

### 3. Аудио и Синтез речи (TTS)
- **Движок**: `edge-tts` (Python-обертка для Microsoft Edge Online TTS).
- **Почему Edge-TTS?**:
    - Бесплатно (не требует API ключа).
    - Высокое качество нейронных голосов (`ru-RU-DmitryNeural`, `ru-RU-SvetlanaNeural`).
    - Меньшая задержка по сравнению с gTTS.
- **Асинхронность**: Streamlit работает синхронно, а `edge-tts` — асинхронно. Используется мост `asyncio.run()` внутри вспомогательных функций.
- **Поток данных**: Текст -> поток `edge-tts` -> буфер `BytesIO` -> кодирование в Base64 -> HTML5 Аудио Плеер.

### 4. Кастомные UI компоненты
- **Аудио Плеер**:
    - **Проблема**: Стандартный `st.audio` выглядит устаревшим и плохо кастомизируется.
    - **Решение**: Свой HTML/CSS/JS плеер, внедряемый через `st.components.v1.html`.
    - **Функции**: Base64 эмбеддинг, градиентный фон, поддержка перемотки (seek slider), формат времени `MM:SS`.
    - **Безопасность**: Аудио передается как байт-строка, временные файлы на диске не создаются.

## Структура файлов
- `app.py`: Монолитный входной файл, содержащий UI, логику и асинхронные функции.
- `.streamlit/secrets.toml`: Локальная конфигурация с ключами (игнорируется Git).
- `requirements.txt`: Список зависимостей Python.

## Масштабируемость
- **База данных**: Сейчас состояние хранится в RAM. В будущем: Supabase/PostgreSQL для сохранения любимых сказок.
- **Модели**: Легкое переключение на OpenAI/Claude через конфиг при необходимости.
- **Голоса**: Расширение до клонирования голосов (например, голоса родителей) через ElevenLabs в Pro-версии.
